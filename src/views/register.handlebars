{{> headerhome}}

<div class="form-container">
  <form id="registerForm">

    <div class="form-group">
      <label for="first_name">Nombre:</label>
      <input type="text" id="first_name" name="first_name" value="{{first_name}}" required>
    </div>

    <div class="form-group">
      <label for="last_name">Apellido:</label>
      <input type="text" id="last_name" name="last_name" value="{{last_name}}" required>
    </div>

    <div class="form-group">
      <label for="email">Correo electrónico:</label>
      <input type="email" id="email" name="email" value="{{email}}" required>
    </div>

    <div class="form-group">
      <label for="age">Edad:</label>
      <input type="number" id="age" name="age" value="{{age.$numberInt}}" required>
    </div>

    <div class="form-group">
      <label for="password">Contraseña:</label>
      <input type="password" id="password" name="password" value="{{password}}" required>
    </div>

    {{!-- <div class="form-group">
      <label for="role">Rol:</label>
      <select id="role" name="role">
        <option value="user" {{#if (eq role "user" )}}selected{{/if}}>Usuario</option>
        <option value="admin" {{#if (eq role "admin" )}}selected{{/if}}>Administrador</option>
      </select>
    </div> --}}

    <button type="submit">Registrar</button>
  </form>


  {{#if err}}
  <p class="error">{{err}}</p>
  {{/if}}
</div>

<script>

  document.getElementById('registerForm').addEventListener('submit', async (event) => {
    event.preventDefault()

    const first_name = document.getElementById("first_name").value
    const last_name = document.getElementById("last_name").value
    const email = document.getElementById("email").value
    const age = document.getElementById("age").value
    const password = document.getElementById("password").value

    try {
      const response = await fetch('http://localhost:8080/api/users', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ first_name, last_name, email, age, password }),
        credentials: 'include'
      })

      if (response.ok) {

        const data = await response.json()

        window.location.href = '/users/login'

      } else {
        const errorData = await response.json()
        console.log(errorData);

        window.location.href = `/users/register/?err=${errorData.error}`


      }

    } catch (error) {
      console.error('Error de red o del servidor:', error)

    }
  })
</script>