<header>
    <h1>{{title}}</h1>
    <nav>
        <a href="/">Inicio</a>
    </nav>
</header>
<main>
<section class="products-list">
    {{#if cart.products}}
    {{#each cart.products}}
    <article class="product">
        {{#if product.thumbnails}}
        {{#each product.thumbnails}}
        <img src={{this}}>
        {{/each}}
        {{else}}
        <img src='/products/img/noimage.png' alt='No hay imagen'>
        {{/if}}
        <P>{{product.title}}</P>
        <P>${{product.price}}</P>
        <P>{{product.description}}</P>
        <label for="cantidad">Cantidad a comprar: </label>
        <input type="number" id="cantidad" value="{{quantity}}" min="1" onchange="actualizarCantidad(this.value, '{{../cart._id}}', '{{product._id}}')">
        <button data-productId="{{product._id}}" data-cartId="{{../cart._id}}"
            class="delete-product-cart">Eliminar</button>
    </article>
    {{/each}}
    <button data-cartId="{{cart._id}}" id="vaciar-carrito">Vaciar Carrito</button>
    {{else}}
    <p>El carrito está vacío</p>
    {{/if}}
</section>
</main>
{{> footer}}

<script>
    const button = document.querySelectorAll('.delete-product-cart')
    button.forEach(btn => {
        btn.onclick = async (e) => {
            const productId = btn.getAttribute('data-productId')
            const cartId = btn.getAttribute('data-cartId')
            await fetch('/carts', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ cid: cartId, pid: productId })
            })

            btn.parentElement.remove()
            
        }
    })

    const buttonDeletProducts = document.querySelector('#vaciar-carrito')
    buttonDeletProducts.onclick = async () => {
        const cartId = buttonDeletProducts.getAttribute('data-cartId')
        await fetch(`/carts/${cartId}`, {
            method: 'DELETE'
        })            
        
        const productNodes =  buttonDeletProducts.parentElement.querySelectorAll('article')
        productNodes.forEach(p => p.remove())
    }
</script>