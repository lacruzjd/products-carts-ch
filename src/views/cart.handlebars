<header>
    <h1>{{title}}</h1>
    <nav>
        <a href="/">Inicio</a>
    </nav>
</header>
<main>
    <section id="cart">
        {{#if cart.products}}
        {{#each cart.products}}
        <article class="product">
            {{#if product.thumbnails}}
            {{#each product.thumbnails}}
            <img src={{this}}>
            {{/each}}
            {{else}}
            <img src='/products/img/noimage.png' alt='No hay imagen'>
            {{/if}}
            <P>{{product.title}}</P>
            <P>${{product.price}}</P>
            <P>{{product.description}}</P>
            <label for="cantidad">Cantidad a comprar: </label>
            <input type="number" id="cantidad" value="{{quantity}}" min="1"
                onchange="actualizarCantidad(this.value, '{{../cart._id}}', '{{product._id}}')">
            <button data-productId="{{product._id}}" data-cartId="{{../cart._id}}"
                class="delete-product-cart">Eliminar</button>
        </article>
        {{/each}}
        <button data-cartId="{{cart._id}}" id="vaciar-carrito">Vaciar Carrito</button>
        <button id="generar-tiket">Generar Ticket</button>
        {{else}}
        <p>El carrito está vacío</p>
        {{/if}}
    </section>
</main>
{{> footer}}

<script>
    const buttonDeletProducts = document.querySelector('#vaciar-carrito')
    if (buttonDeletProducts) {
        buttonDeletProducts.onclick = async () => {
            const cartId = buttonDeletProducts.getAttribute('data-cartId')
            await fetch(`/api/carts/${cartId}`, {
                method: 'DELETE'
            })

            const productNodes = buttonDeletProducts.parentElement.querySelectorAll('article')
            productNodes.forEach(p => p.remove())
            buttonDeletProducts.remove()
        }
    }

    const buttonGeneraTicket = document.querySelector('#generar-tiket')
    if (buttonGeneraTicket) {
        buttonGeneraTicket.onclick = async () => {
        window.location.href = '/tickets'


        }
    }
           
</script>